
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>QSAR.preprocessing &#8212; QSAR 0.0.2 documentation</title>
    <link rel="stylesheet" href="../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../index.html">
          <span>QSAR 0.0.2 documentation</span></a></h1>
        <h2 class="heading"><span>QSAR.preprocessing</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <h1>Source code for QSAR.preprocessing</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>

<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">chained_assignment</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="throw_na"><a class="viewcode-back" href="../../api.html#QSAR.preprocessing.throw_na">[docs]</a><span class="k">def</span> <span class="nf">throw_na</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">perc</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">na_nine</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;remove columns if na, which include true na and also old fashion na -9999, over certain percentage</span>
<span class="sd">    </span>
<span class="sd">    :param df: input pandas data.frame</span>
<span class="sd">    :type df: data frame</span>
<span class="sd">    :param perc: percentage of missing values, defaults to 0.7</span>
<span class="sd">    :type perc: float, optional</span>
<span class="sd">    :param na_nine: whether using old-fashion na -9999 in data, defaults to False</span>
<span class="sd">    :type na_nine: bool, optional</span>
<span class="sd">    :return: data frame without na</span>
<span class="sd">    :rtype: data frame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">processed_df</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">na_nine</span><span class="p">:</span>
        <span class="c1"># if we are dealing with -9999</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">9999</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">processed_df</span> <span class="o">=</span> <span class="n">df</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># gather index for more than a certain percentage NaN</span>
        <span class="n">remove_idx</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()[(</span><span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">perc</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>

        <span class="c1"># drop these columns</span>
        <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">remove_idx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">processed_df</span> <span class="o">=</span> <span class="n">df</span>

    <span class="k">return</span> <span class="n">processed_df</span></div>


<div class="viewcode-block" id="throw_zero"><a class="viewcode-back" href="../../api.html#QSAR.preprocessing.throw_zero">[docs]</a><span class="k">def</span> <span class="nf">throw_zero</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">perc</span><span class="o">=</span><span class="mf">0.7</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove column if zero values over certain percentage</span>
<span class="sd">    </span>
<span class="sd">    :param df: input pandas data.frame</span>
<span class="sd">    :type df: data frame</span>
<span class="sd">    :param perc: percentage of missing values, defaults to 0.7</span>
<span class="sd">    :type perc: float, optional</span>
<span class="sd">    :return: processed data frame</span>
<span class="sd">    :rtype: data frame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">((</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
            <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="remove_inf_fillna"><a class="viewcode-back" href="../../api.html#QSAR.preprocessing.remove_inf_fillna">[docs]</a><span class="k">def</span> <span class="nf">remove_inf_fillna</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">na_nine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">median</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; removes infinities, replaces with max and min value, and fill Na with stats</span>
<span class="sd">    </span>
<span class="sd">    :param df: input pandas data.frame</span>
<span class="sd">    :type df: data frame</span>
<span class="sd">    :param stats: statistics container have min, max and median of each column,</span>
<span class="sd">        defaults to None</span>
<span class="sd">    :type stats: data frames</span>
<span class="sd">    :param na_nine: whether na is old fashion -9999, defaults to False</span>
<span class="sd">    :type na_nine: bool, optional</span>
<span class="sd">    :param train: whether is training dataset, defaults to False</span>
<span class="sd">    :type train: bool, optional</span>
<span class="sd">    :param median: whether fill na with median, defaults to False</span>
<span class="sd">    :type median: bool, optional</span>
<span class="sd">    :return: processed data frame + stats calculated from training dataset (max, min and median)</span>
<span class="sd">    :rtype: data frames</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">max_val_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">min_val_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">median_</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">train</span><span class="p">:</span>
            <span class="n">max_val</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">min_val</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">median</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
            <span class="n">max_val_</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_val</span>
            <span class="n">min_val_</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_val</span>
            <span class="n">median_</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">median</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_val</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;max_val&#39;</span><span class="p">][</span><span class="n">col</span><span class="p">]</span>
            <span class="n">min_val</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;min_val&#39;</span><span class="p">][</span><span class="n">col</span><span class="p">]</span>
            <span class="n">median</span>  <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;median&#39;</span><span class="p">][</span><span class="n">col</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">max_val</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">min_val</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">na_nine</span> <span class="ow">or</span> <span class="n">median</span><span class="p">:</span>
            <span class="c1"># if we are dealing with -9999</span>
            <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">9999</span><span class="p">]</span> <span class="o">=</span> <span class="n">median</span>
            <span class="n">fill_value</span> <span class="o">=</span> <span class="n">median_</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fill_value</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">fill_value</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">train</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">max_val_</span><span class="p">,</span> <span class="n">min_val_</span><span class="p">,</span> <span class="n">median_</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="remove_outliers"><a class="viewcode-back" href="../../api.html#QSAR.preprocessing.remove_outliers">[docs]</a><span class="k">def</span> <span class="nf">remove_outliers</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutoff_iqr</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;remove outliers using 1.5 inter-quantile</span>
<span class="sd">    </span>
<span class="sd">    :param df: input data frame</span>
<span class="sd">    :type df: data frame</span>
<span class="sd">    :param stats: stats: statistics container have min, max and median of each column,, defaults to None</span>
<span class="sd">    :type stats: data frame, optional</span>
<span class="sd">    :param cutoff_iqr: outlier cutoff param, defaults to 1.5</span>
<span class="sd">    :type cutoff_iqr: float, optional</span>
<span class="sd">    :param train: whether it&#39;s training dataset, defaults to False</span>
<span class="sd">    :type train: bool, optional</span>
<span class="sd">    :return: processed data frame by removing outliers</span>
<span class="sd">    :rtype: [type]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Replaces outliers with lower or upper cutoff</span>
    <span class="n">q25_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">q75_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">df</span><span class="p">:</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">train</span><span class="p">:</span>
            <span class="c1"># calculate interquartile range</span>
            <span class="n">q25</span><span class="p">,</span> <span class="n">q75</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
            <span class="n">q25_</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">q25</span>
            <span class="n">q75_</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">q75</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">q25</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;q25&#39;</span><span class="p">][</span><span class="n">col_name</span><span class="p">]</span>
            <span class="n">q75</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;q75&#39;</span><span class="p">][</span><span class="n">col_name</span><span class="p">]</span>
        <span class="n">iqr</span> <span class="o">=</span> <span class="n">q75</span> <span class="o">-</span> <span class="n">q25</span>
        <span class="c1"># calculate the outlier cutoff</span>
        <span class="n">cut_off</span> <span class="o">=</span> <span class="n">iqr</span> <span class="o">*</span> <span class="n">cutoff_iqr</span>
        <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">q25</span> <span class="o">-</span> <span class="n">cut_off</span><span class="p">,</span> <span class="n">q75</span> <span class="o">+</span> <span class="n">cut_off</span>
        <span class="c1"># identify outliers</span>
        <span class="n">col</span><span class="p">[</span><span class="n">col</span> <span class="o">&lt;</span> <span class="n">lower</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span>
        <span class="n">col</span><span class="p">[</span><span class="n">col</span> <span class="o">&gt;</span> <span class="n">upper</span><span class="p">]</span> <span class="o">=</span> <span class="n">upper</span>
        <span class="n">df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>
    <span class="k">if</span> <span class="n">train</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">q25_</span><span class="p">,</span> <span class="n">q75_</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="minmax"><a class="viewcode-back" href="../../api.html#QSAR.preprocessing.minmax">[docs]</a><span class="k">def</span> <span class="nf">minmax</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;min max normalization</span>
<span class="sd">    </span>
<span class="sd">    :param df: input data frame</span>
<span class="sd">    :type df: data frame</span>
<span class="sd">    :param a: low end of scaling range, defaults to 0</span>
<span class="sd">    :type a: int, optional</span>
<span class="sd">    :param b: high end of scaling range, defaults to 1</span>
<span class="sd">    :type b: int, optional</span>
<span class="sd">    :param scaler: other type of scaler, defaults to None</span>
<span class="sd">    :type scaler: class, optional</span>
<span class="sd">    :param dtype: data type, defaults to &#39;float32&#39;</span>
<span class="sd">    :type dtype: str, optional</span>
<span class="sd">    :return: normalized data set</span>
<span class="sd">    :rtype: [type]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">processed_dat</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">scaler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">processed_dat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">processed_dat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> \
            <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">processed_dat</span></div>


<div class="viewcode-block" id="find_labels"><a class="viewcode-back" href="../../api.html#QSAR.preprocessing.find_labels">[docs]</a><span class="k">def</span> <span class="nf">find_labels</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">cat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Function that takes in dictionary of categories and classifies rows of \</span>
<span class="sd">        series</span>
<span class="sd">    </span>
<span class="sd">    :param s: [description]</span>
<span class="sd">    :type s: [type]</span>
<span class="sd">    :param cat: dictionary of categories</span>
<span class="sd">    :type cat: dictionary</span>
<span class="sd">    :return: series</span>
<span class="sd">    :rtype: pd series</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">val</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">cat</span><span class="p">:</span>
                    <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y</span><span class="p">)</span></div>


<div class="viewcode-block" id="process_prog"><a class="viewcode-back" href="../../api.html#QSAR.preprocessing.process_prog">[docs]</a><span class="k">def</span> <span class="nf">process_prog</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Some features in the bio chemical features file need string processing</span>
<span class="sd">    This function takes these columns marked that contain information about prognostics</span>
<span class="sd">    It processes the string and makes it into categorical features</span>
<span class="sd">    :param df: input data frame for columns containing prognostic features</span>
<span class="sd">    :type df: data frame</span>
<span class="sd">    :return: [description] Dataframe of processed categorical types</span>
<span class="sd">    :rtype: [type] dataframe</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prog</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">s_split</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="c1"># finding two words that should be one</span>
        <span class="n">twowords</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">oneword</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">s_split</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">val</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">val</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
                            <span class="n">oneword</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">val</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                            <span class="n">twowords</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">val</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">words</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">oneword</span><span class="p">,</span> <span class="n">twowords</span><span class="p">):</span>
            <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># finding independent categories</span>
        <span class="c1"># finding two words that should be one</span>
        <span class="n">cat</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">val</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
                        <span class="n">cat</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">prog</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">find_labels</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span>
        <span class="n">prog</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
    <span class="k">return</span> <span class="n">prog</span></div>


<div class="viewcode-block" id="fill_missing_one_hot"><a class="viewcode-back" href="../../api.html#QSAR.preprocessing.fill_missing_one_hot">[docs]</a><span class="k">def</span> <span class="nf">fill_missing_one_hot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adding missing columns with zero columns</span>
<span class="sd">    </span>
<span class="sd">    :param df: input data frame</span>
<span class="sd">    :type df: data frame</span>
<span class="sd">    :param columns: column names</span>
<span class="sd">    :type columns: list</span>
<span class="sd">    :return: data frame with zero columns added.</span>
<span class="sd">    :rtype: data frame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">missing_columns</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[</span><span class="o">~</span><span class="n">columns</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">missing_columns</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="create_subcell_df"><a class="viewcode-back" href="../../api.html#QSAR.preprocessing.create_subcell_df">[docs]</a><span class="k">def</span> <span class="nf">create_subcell_df</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function that processing cell biology data file</span>
<span class="sd">    This function preprocesses the subcellular location feature from cell biology file</span>
<span class="sd">    </span>
<span class="sd">    :param df: input cell biology data frame</span>
<span class="sd">    :type df: data frame</span>
<span class="sd">    :return: sub-cellular location data frame</span>
<span class="sd">    :rtype: data frame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">subcell_loc</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Subcellular.location..CC.&#39;</span><span class="p">]</span>

    <span class="c1"># Removing unnecessary string</span>
    <span class="n">subcell_loc</span> <span class="o">=</span> <span class="n">subcell_loc</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;SUBCELLULAR LOCATION: &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="c1"># Removing stirng inside curly braces</span>
    <span class="n">subcell_loc</span> <span class="o">=</span> <span class="n">subcell_loc</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;\{([^}]+)\}&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="c1"># subcell_loc = subcell_loc.str.replace(&#39;\(([^}]+)\)&#39;, &#39;&#39;)</span>
    <span class="n">subcell_loc</span>

    <span class="n">category_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nucleus&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;nucleus&#39;</span><span class="p">,</span> <span class="s1">&#39;nuclear&#39;</span><span class="p">,</span> <span class="s1">&#39;chromosome&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;cytoplasm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;cytoplasm&#39;</span><span class="p">,</span> <span class="s1">&#39;cytosol&#39;</span><span class="p">,</span> <span class="s1">&#39;cytoskeleton&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;extracellular&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;extracellular&#39;</span><span class="p">,</span> <span class="s1">&#39;secreted&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;mitochondria&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mitochondria&#39;</span><span class="p">,</span> <span class="s1">&#39;mitochondrial&#39;</span><span class="p">,</span> \
                        <span class="s1">&#39;mitochondrion&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;cell membrane&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;cell membrane&#39;</span><span class="p">,</span> <span class="s1">&#39;cell  projection&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;endoplasmic reticulum&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;endoplasmic reticulum&#39;</span><span class="p">,</span> \
                        <span class="s1">&#39;sarcoplasmic&#39;</span><span class="p">,</span> <span class="s1">&#39;microsome&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;golgi&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;golgi&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;lysosome&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;lysosome&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;peroxisome&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;peroxisome&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;None&#39;</span><span class="p">:</span> <span class="p">[]}</span>
    
    <span class="n">subcell_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">category_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">subcell_loc</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># iterate over subcellular location cc column</span>
        <span class="c1"># Flag to see if at least one location is found</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># check if nan</span>
        <span class="k">if</span> <span class="n">line</span> <span class="o">!=</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">subcell_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">category_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">sub_string</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sub_string</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">subcell_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                <span class="n">subcell_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">continue</span>
    <span class="n">subcell_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">subcell_df</span></div>

<div class="viewcode-block" id="reshape"><a class="viewcode-back" href="../../api.html#QSAR.preprocessing.reshape">[docs]</a><span class="k">def</span> <span class="nf">reshape</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s1">&#39;clean&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function reshapes the dataframe for input into the autoencoder.</span>
<span class="sd">    The padding is required because the autoencoder loses some features when decoding.</span>
<span class="sd">    This is because the maxpooling will cut feature length in half, and when there are odd numbers, it wil round up</span>
<span class="sd">    </span>
<span class="sd">    :param df: input data frame</span>
<span class="sd">    :type df: data frame</span>
<span class="sd">    :param features: whether the data frame is cleaned or raw, defaults to &#39;clean&#39;</span>
<span class="sd">    :type features: str, optional</span>
<span class="sd">    :raises Exception: Only allow clean and raw as input</span>
<span class="sd">    :return: reshaped data frame that can fit into convolutional autoencoder.</span>
<span class="sd">    :rtype: data frame</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">features</span> <span class="o">==</span> <span class="s1">&#39;clean&#39;</span><span class="p">:</span>
        <span class="c1"># Reshaping array for convolutional autoencoder</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">53</span><span class="p">)),</span> <span class="n">df</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">54</span><span class="p">))],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Invalid feature transformation request. Options: </span><span class="se">\</span>
<span class="s1">            &quot;clean&quot;, &quot;raw&quot;&#39;</span><span class="p">)</span></div>
    <span class="c1"># TODO add raw data reshape</span>

</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Xi Chen.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.0.
    </div>
  </body>
</html>